<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì™„ì„±! - Masterpiece</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        body { font-family: 'Pretendard', sans-serif; }

        .result-image {
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
    </style>
</head>
<body class="bg-white min-h-screen">
    <!-- í—¤ë” -->
    <div class="bg-black py-5">
        <h1 class="text-white text-3xl font-bold text-center">
            ğŸ‰ ì´¬ì˜ ì™„ë£Œ!
        </h1>
    </div>

    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <div class="max-w-6xl mx-auto px-8 py-8">
        <div class="grid grid-cols-2 gap-12 items-center" style="max-height: 80vh;">
            <!-- ì™¼ìª½: ì™„ì„±ëœ ì‚¬ì§„ -->
            <div class="bg-gray-50 rounded-3xl p-6 flex items-center justify-center" style="max-height: 75vh;">
                <div class="result-image" style="max-height: 100%; max-width: 100%;">
                    <img id="finalImage" src="" alt="ì™„ì„±ëœ ì‚¬ì§„"
                         class="rounded-2xl shadow-2xl" style="max-height: 65vh; width: auto; object-fit: contain;">
                </div>
            </div>

            <!-- ì˜¤ë¥¸ìª½: QR ì½”ë“œ & ë‹¤ìš´ë¡œë“œ -->
            <div class="flex flex-col justify-center">
                <div class="text-center mb-8">
                    <h2 class="text-2xl font-bold mb-3">QR ì½”ë“œë¡œ ë‹¤ìš´ë¡œë“œ</h2>
                    <p class="text-gray-600 mb-6 text-sm">
                        QR ì½”ë“œë¥¼ ìŠ¤ìº”í•˜ì—¬<br>
                        ì‚¬ì§„ì„ ë‹¤ìš´ë¡œë“œí•˜ì„¸ìš”
                    </p>

                    <!-- QR ì½”ë“œ -->
                    <div class="inline-block bg-white p-6 rounded-2xl shadow-lg">
                        <img id="qrCode" src="" alt="QR ì½”ë“œ"
                             class="w-48 h-48">
                    </div>
                </div>

                <!-- ë²„íŠ¼ë“¤ -->
                <div class="space-y-3">
                    <button onclick="downloadPhoto()"
                            class="w-full bg-black text-white font-bold text-lg
                                   py-4 rounded-2xl hover:bg-gray-800 transition">
                        ì§ì ‘ ë‹¤ìš´ë¡œë“œ
                    </button>

                    <button onclick="restart()"
                            class="w-full bg-white text-black font-bold text-lg
                                   py-4 rounded-2xl border-2 border-black
                                   hover:bg-gray-50 transition">
                        ì²˜ìŒìœ¼ë¡œ
                    </button>
                </div>

                <!-- ì¹´ìš´íŠ¸ë‹¤ìš´ -->
                <div class="text-center mt-6 text-gray-500">
                    <p id="countdown" class="text-sm">
                        30ì´ˆ í›„ ìë™ìœ¼ë¡œ ì²˜ìŒ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let result = null;
        let countdownSeconds = 30;
        let countdownInterval = null;

        // ê²°ê³¼ ë°ì´í„° ë¡œë“œ
        function loadResult() {
            const resultJson = sessionStorage.getItem('finalResult');
            if (!resultJson) {
                alert('ê²°ê³¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                window.location.href = '/app/start';
                return;
            }

            result = JSON.parse(resultJson);

            // ì´ë¯¸ì§€ í‘œì‹œ
            if (result.finalImage) {
                document.getElementById('finalImage').src = result.finalImage;
            }

            // QR ì½”ë“œ í‘œì‹œ
            if (result.qrCode) {
                document.getElementById('qrCode').src = result.qrCode;
            }

            // ì¹´ìš´íŠ¸ë‹¤ìš´ ì‹œì‘
            startCountdown();
        }

        // ì¹´ìš´íŠ¸ë‹¤ìš´
        function startCountdown() {
            countdownInterval = setInterval(() => {
                countdownSeconds--;
                document.getElementById('countdown').textContent =
                    `${countdownSeconds}ì´ˆ í›„ ìë™ìœ¼ë¡œ ì²˜ìŒ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤`;

                if (countdownSeconds <= 0) {
                    restart();
                }
            }, 1000);
        }

        // ë‹¤ìš´ë¡œë“œ
        function downloadPhoto() {
            if (result && result.finalImage) {
                const a = document.createElement('a');
                a.href = result.finalImage;
                a.download = 'masterpiece_photo.jpg';
                a.click();
            }
        }

        // ì²˜ìŒìœ¼ë¡œ
        function restart() {
            clearInterval(countdownInterval);
            sessionStorage.clear();
            window.location.href = '/app/start';
        }

        // ì´ˆê¸°í™”
        loadResult();
    </script>
</body>
</html>
